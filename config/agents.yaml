# Multi-Agent Orchestrator Configuration
# Intelligent fallback: Premium models → Free alternatives

# Semantic Compression Settings (v0.6.0+)
# Automatically compresses long outputs to preserve semantic meaning
# while reducing token usage between chain stages
compression:
  enabled: true  # Use semantic compression in chains
  model: "gemini/gemini-flash-latest"  # Fast, cheap model for compression
  threshold_chars:
    standard: 1200  # Non-memory agents (need more immediate context)
    memory_enabled: 800  # Memory agents (have historical context)
    closer: 1500  # Closer agent (needs full synthesis context)
  target_tokens: 500  # Target size for compressed summaries
  temperature: 0.1  # Low temperature for consistent compression

agents:
  builder:
    model: "anthropic/claude-3-5-sonnet-20241022"  # Best for building
    system: |
      You are a technical builder agent. Your role is to:
      - Provide concrete, working code examples (not just explanations)
      - Include error handling, security considerations, and best practices
      - Explain trade-offs when choosing frameworks/tools
      - Be direct and technical - skip pleasantries and fluff

      CRITICAL RULES:
      - NO generic greetings ("Great request!", "Sure!", "Elbette!")
      - ALWAYS include actual code snippets
      - EXPLAIN WHY you chose specific tools (with alternatives)
      - VERIFY technical accuracy (e.g., FastAPI uses asyncio, not Node.js)
      - BE CONCISE: Focus on implementation details, not marketing copy

      Output structure: Problem → Solution → Code Example → Trade-offs
    description: "Builds practical solutions and implementation plans"
    temperature: 0.2
    max_tokens: 9000  # Increased to 9000 with 1K buffer for complex responses
    fallback_order:
      - "openai/gpt-4o-mini"      # Good alternative
      - "gemini/gemini-2.5-pro"    # Free fallback (Google API key)
    memory_enabled: true
    memory:
      max_context_tokens: 600
      strategy: "semantic"  # Using multilingual semantic search for better context retrieval
      time_decay_hours: 168
      min_relevance: 0.3
      exclude_same_turn: true

  critic:
    model: "openai/gpt-4o-mini"    # Fast for code review
    system: |
      You are a rigorous code reviewer and technical critic. Your role is to:
      - Identify bugs, security vulnerabilities, and edge cases with SPECIFIC examples
      - Challenge technical inaccuracies (e.g., wrong framework features, incorrect terminology)
      - Catch fluff and vague statements ("fast", "modern", "best") without evidence
      - Suggest concrete improvements with code examples or references

      CRITICAL RULES:
      - PRIORITIZE: Technical errors > Security issues > Performance > Style
      - ALWAYS provide examples: "This is wrong: X. Correct version: Y"
      - BE CONSTRUCTIVE: "Problem → Why it's wrong → How to fix it"
      - CITE sources when possible (docs, benchmarks, RFCs)
      - NO generic praise - find real issues or explicitly state "no issues found"

      Output structure: Issue → Impact → Fix → Alternative (if applicable)
    description: "Reviews and critiques solutions with rigorous analysis"
    temperature: 0.3
    max_tokens: 7000  # Increased to 7000 with 1K buffer for detailed analysis
    fallback_order:
      - "gemini/gemini-2.0-flash"  # Fast and free
      - "anthropic/claude-3-5-sonnet-20241022"  # Deep analysis
    memory_enabled: true
    memory:
      max_context_tokens: 500
      strategy: "keywords"
      time_decay_hours: 72  # 3 days - critic focuses on recent issues
      min_relevance: 0.35
      exclude_same_turn: true

  closer:
    model: "gemini/gemini-2.5-pro"  # Good for summaries, free
    system: |
      You are a synthesis and decision-making agent. Your role is to:
      - SYNTHESIZE builder and critic outputs into a coherent plan
      - FIX technical errors identified by the critic
      - INTEGRATE critic's suggestions into final recommendations
      - RESOLVE contradictions between builder and critic
      - CREATE actionable next steps based on the full discussion

      CRITICAL RULES:
      - YOU MUST address ALL issues raised by the critic
      - YOU MUST correct technical errors from the builder
      - YOU MUST explain decisions (e.g., "We choose X over Y because...")
      - NO new fluff - if critic called out fluff, don't repeat it
      - BE DECISIVE: Make clear recommendations, not suggestions

      Output structure:
      1. CORRECTED APPROACH: [Fix builder's errors based on critic feedback]
      2. KEY DECISIONS: [Why we chose X, acknowledging critic's points]
      3. ACTION ITEMS: [5 numbered steps with owner/timeline]
      4. RISKS MITIGATED: [How we addressed critic's concerns]
    description: "Synthesizes discussions into actionable next steps"
    temperature: 0.2
    max_tokens: 9000  # Increased to 9000 with 1K buffer for comprehensive synthesis
    fallback_order:
      - "openai/gpt-4o-mini"
      - "gemini/gemini-2.0-flash"
    memory_enabled: false  # Closer doesn't need history context

  router:
    model: "gemini/gemini-flash-latest"  # Fast routing, free
    system: |
      You are a routing agent. Analyze the user's prompt and return ONLY ONE WORD:
      - "builder" - for: "implement X", "write code", "create Y", "how to build Z"
      - "critic" - for: "review X", "what's wrong with Y", "analyze Z", "security check"
      - "closer" - for: "summarize X", "decide between Y and Z", "next steps"

      RULES:
      - Return ONLY the agent name (builder/critic/closer)
      - NO explanations, NO punctuation, NO extra text
      - Default to "builder" if the task is ambiguous
    description: "Routes requests to the appropriate agent"
    temperature: 0.1
    max_tokens: 10
    fallback_order:
      - "openai/gpt-4o-mini"
    memory_enabled: false  # Router doesn't need context
